202301311244
Status: #cme #firefox #procdump #sidbrute #sysinternals
Tags: [[Labs]]

# Heist
IP: 10.10.10.149

## Recon

Ports open:

```
PORT      STATE SERVICE
80/tcp    open  http
135/tcp   open  msrpc
445/tcp   open  microsoft-ds
5985/tcp  open  wsman
49669/tcp open  unknown
```

Port 80:

- Found a directory `/issues.php` that contains a conversation between the user `Hazard` and `Admin`

![[heist_conversation.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/heist_conversation.png">

- There was also a config file attached that contained a hash and encrypted cisco type 7 passwords
- We can decrypt these passwords with ciscot7 tool, however we will just use an online tool
- We decrypt them and get: `$uperP@ssword` and `Q4)sJu\Y8qz*A3?d`
- We cracked the hash using hashcat: `$1$pdQG$o8nrSzsGXeaduXrjlvKc91:stealth1agent`
- We also have possible users: `hazard, Admin, rout3r`
- We then try to password spray against our users using crackmapexec and find that `hazard:stealth1agent` are valid credentials

![[heist_validcreds.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/heist_validcreds.png">

## Establish Foothold

- It seems after trying to authenticate via winRM with our credentials, it is unsuccessful
- There are also no shares of interest and do not find any further information
- With our credentials, we could bruteforce SIDs with an impacket tool

```bash
lookupsid.py $DOMAIN/$USER:$PASS@10.10.10.149
```

- We can also do this manually with rpcclient
- However, we end up using the impacket tool and found other users

```
[*] Brute forcing SIDs at 10.10.10.149
[*] StringBinding ncacn_np:10.10.10.149[\pipe\lsarpc]
[*] Domain SID is: S-1-5-21-4254423774-1266059056-3197185112
500: SUPPORTDESK\Administrator (SidTypeUser)
501: SUPPORTDESK\Guest (SidTypeUser)
503: SUPPORTDESK\DefaultAccount (SidTypeUser)
504: SUPPORTDESK\WDAGUtilityAccount (SidTypeUser)
513: SUPPORTDESK\None (SidTypeGroup)
1008: SUPPORTDESK\Hazard (SidTypeUser)
1009: SUPPORTDESK\support (SidTypeUser)
1012: SUPPORTDESK\Chase (SidTypeUser)
1013: SUPPORTDESK\Jason (SidTypeUser)
```

- Now we try to bruteforce with our password and users files using crackmapexec
- We found new valid credentials: `chase:Q4)sJu\Y8qz*A3?d`
- We are also able to get a shell with evil-winrm using these credentials
- After enumerating manually, we were able to find that firefox is installed and running
- We can try to dump the process `ProcDump` 
- We download and transfer the executable to the victim machine and run it for the firefox process
- We then download the dmp file and start to analyze it with strings and grep for password

![[heist_procdump.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/heist_procdump.png">

- We found valid credentials for the admin user
- We try this password for Administrator via crackmapexec and find that these credentials work
- We also have read and write to shares and are able to use psexec to get a shell






---
# References

https://github.com/theevilbit/ciscot7

https://www.router-switch.com/faq/six-types-of-cisco-password.html

https://www.firewall.cx/cisco-technical-knowledgebase/cisco-routers/358-cisco-type7-password-crack.html