## Introduction to Authentication

Authentication - Who you are
Authorization - What you have access to

## Brute-force Attacks

- [!] There are different tools that you can use to initiate a bruteforce attack, however here are two examples using burpsuite and ffuf
#### Using ffuf

- Save the request into a file via burp

```
POST /labs/a0x01.php HTTP/1.1
Host: 192.168.149.128
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded
Content-Length: 31
Origin: http://192.168.149.128
Connection: close
Referer: http://192.168.149.128/labs/a0x01.php
Upgrade-Insecure-Requests: 1

username=jeremy&password=FUZZ
```

- Make sure to replace the position you want to bruteforce with the `FUZZ` keyword
- Bruteforce Jeremy's password using ffuf:

`ffuf -request req.txt -request-proto http -w /path/to/wordlist -fs 1814`

- We get one that does not have a response size of 1814:

`letmein [Status: 200, Size: 1808, Words: 494, Lines: 47, Duration: 16ms]`

#### Using Burp Extension Turbo Intruder

- First install the Turbo Intruder extension on Burp
- Now select the position that you want to bruteforce and send it to Turbo Intruder:

![[turbo_intruder.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/turbo_intruder.png">

- You can see that the position chosen to fuzz is replaced with `%s`
- Within the python code, replace the wordlist with the one of your choice:

![[turbo_intruder2.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/turbo_intruder2.png">

- Then initiate the attack and you should see that it gives you the successful request, indicating that we successfully bruteforced Jeremy's password

## Attacking MFA

- In this case, we have credentials that we can use to login
- Once we are logged in, we have to supply our MFA code given to us

![[mfa_bypass.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/mfa_bypass.png">

- The only field we can edit is the MFA field
- We can use burp to edit the `Username` field and change it to Jeremy, as that is our target account

![[mfa_bypass2.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/mfa_bypass2.png">

- Once we forward this request with our modified parameter, we will see that it welcomes us with `Welcome Jeremy`, meaning that we laterally moved into Jeremy's account after attacking MFA

## IDOR - Insecure Direct Object Reference

- When we find a specific parameter or endpoint that contains some kind of unique identifier for an account, we want to test for IDORs:

![[idor_1.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/idor_1.png">

- We can now either, fuzz the values for the parameter `account` or we can start manually giving it inputs to check for an IDOR
- In this example, I will create a number list that contains numbers 1 - 2000 using bash

`for i in {1..2000}; do print $i; done > numlist.txt`

- Then I will save a copy of the request from burp into a file and call it `req.txt`
- I will then use ffuf to start fuzzing the `account` parameter:

`ffuf -request req.txt -request-proto http -c -w numlist.txt`

- You should get lots of output with size of 849, thus requiring us to add `-fs 849` to our command
- You should now get valid responses:

![[idor_2.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/idor_2.png">

- Please keep in mind, in a live bugbounty engagement, you want to test this on accounts that you have created.

## Introduction to APIs

- Application Programming Interface - Makes up more than 80% internet traffic
- Many applications are powered by them

## Broken Access Control

- For this section we will discuss about a BFLA (Broken Function Level Authorization) vulnerability with APIs
- We have two account credentials for testing:
	- `jeremy:cheescake`
	- `jessamy:tiramisu`
- We first want to test functionality with our jeremy account

![[bac1.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/bac1.png">

- We were able to login with our credentials for jeremy. This returned a JWT token.
- Now we can get account details utilizing our JWT token

![[bac2.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/bac2.png">

- This returned account details for Jeremy
- We can now utilize the PUT method to update Jeremy's bio

![[bac3.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/bac3.png">

- This updated Jeremy's bio. This is normal functionality using an api 
- Now what if we try to edit Jessamy's using Jeremy's JWT token?

![[bac4.png]]

<img src="https://github.com/charlier0cks/Pentest-Notes/blob/main/Attachments/bac4.png">

- Using Jeremy's JWT token, we were able to change the bio information for Jessamy's account without her credentials
- This is a type of broken access control
